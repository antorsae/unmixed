<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unmixed</title>
  <link rel="stylesheet" href="style.css?v=27">
  <!-- ZIP extraction -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <!-- MP3 encoding -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.min.js"></script>
  <!-- URL compression for sharing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
  <div id="app">
    <!-- Main content area -->
    <main id="main-content">
      <!-- Left sidebar: Profile selector -->
      <aside id="profile-panel">
        <h1 class="app-title">Unmixed <span class="app-author">by Antor</span></h1>
        <div id="profile-name"></div>
        <h2>Anechoic Recordings</h2>
        <p class="panel-subtitle">
          Symphonic recordings from <a href="https://research.cs.aalto.fi/acoustics/virtual-acoustics/research/acoustic-measurement-and-analysis/85-anechoic-recordings.html" target="_blank" rel="noopener">Aalto University</a>
        </p>
        <div id="profile-options">
          <label class="profile-radio">
            <input type="radio" name="profile" value="mozart" checked>
            <span>Mozart - Don Giovanni</span>
          </label>
          <label class="profile-radio">
            <input type="radio" name="profile" value="beethoven">
            <span>Beethoven - Symphony No. 7</span>
          </label>
          <label class="profile-radio">
            <input type="radio" name="profile" value="bruckner">
            <span>Bruckner - Symphony No. 8</span>
          </label>
          <label class="profile-radio">
            <input type="radio" name="profile" value="mahler">
            <span>Mahler - Symphony No. 1</span>
          </label>
        </div>
        <button id="load-profile-btn" class="btn primary">Load recording</button>

        <div id="load-progress" class="hidden">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <span class="progress-text">Loading...</span>
        </div>

        <div id="status-text"></div>

        <div class="divider" id="profile-upload-divider">
          <span>OR</span>
        </div>

        <div class="upload-row">
          <div class="upload-zip-col">
            <button id="upload-zip-btn" class="btn secondary">Upload ZIP</button>
            <input type="file" id="zip-input" accept=".zip" class="hidden">
          </div>
          <div class="upload-files-col" id="drop-zone">
            <button id="browse-files-btn" class="btn secondary">Browse Files</button>
            <p class="hint">MP3, WAV, FLAC, OGG, AAC</p>
            <input type="file" id="files-input" multiple accept="audio/*" class="hidden">
          </div>
        </div>

        <div class="divider">
          <span>COMMUNITY</span>
        </div>

        <div class="community-section">
          <button id="share-btn" class="btn secondary" disabled>üîó Share your arrangement</button>
        </div>
      </aside>

      <!-- Stage canvas -->
      <section id="stage-section">
        <div id="stage-area">
          <div id="hall-controls">
          <div class="hall-control-block hall-controls-top-left">
            <div class="transport-buttons compact">
              <button id="rewind-btn" class="btn transport-btn" title="Rewind (R)">
                <span class="icon">&#x23EE;</span>
              </button>
              <button id="play-btn" class="btn transport-btn primary" title="Play/Pause (Space)">
                <span class="icon play-icon">&#x25B6;</span>
                <span class="icon pause-icon hidden">&#x23F8;</span>
              </button>
              <button id="stop-btn" class="btn transport-btn" title="Stop">
                <span class="icon">&#x23F9;</span>
              </button>
            </div>

            <div class="seek-container hall-seek">
              <input type="range" id="seek-bar" min="0" max="100" value="0" step="0.1">
              <span id="time-display">00:00 / 00:00</span>
            </div>

            <div class="master-gain-container">
              <label for="master-gain">Master</label>
              <input type="range" id="master-gain" min="-36" max="30" value="0" step="0.5">
              <span id="master-gain-value">+00.0 dB</span>
              <label class="master-auto-toggle">
                <input type="checkbox" id="master-auto" checked>
                Auto (<span id="master-auto-target">-18.0 dBFS</span>)
                <a href="https://github.com/antorsae/unmixed#master-loudness--metering" target="_blank" rel="noopener" class="help-link" title="Learn about auto loudness">‚ìò</a>
              </label>
              <div class="master-meter">
                <div class="master-meter-fill" id="master-meter-fill"></div>
              </div>
              <span id="master-meter-text" class="master-meter-text">üîä --.- dBFS | üéØ -18.0 dBFS | Œî --.- dB</span>
              <span id="master-auto-status" class="master-auto-status"></span>
            </div>

            <div class="noise-gate-controls">
              <label class="checkbox-label">
                <input type="checkbox" id="noise-gate-checkbox">
                Noise Gate
                <a href="https://github.com/antorsae/unmixed#noise-gate" target="_blank" rel="noopener" class="help-link" title="Learn about noise gate">‚ìò</a>
              </label>
              <div class="noise-gate-threshold" id="noise-gate-threshold-container">
                <label for="noise-gate-threshold">üëÇüèΩ:</label>
                <input type="range" id="noise-gate-threshold" min="-75" max="-55" value="-74" step="1">
                <span id="noise-gate-threshold-value">-74dB</span>
              </div>
            </div>
          </div>

          <div class="hall-control-block hall-controls-top-right">
            <div class="reverb-controls">
              <div class="reverb-selects">
                <label for="reverb-preset">Reverb: <a href="https://github.com/antorsae/unmixed#reverb-system" target="_blank" rel="noopener" class="help-link" title="Learn about reverb">‚ìò</a></label>
                <select id="reverb-preset">
                  <option value="none" selected>None</option>
                  <option value="small-room">Small Room</option>
                  <option value="chamber">Chamber</option>
                  <option value="concert-hall">Concert Hall</option>
                  <option value="cathedral">Cathedral</option>
                  <option value="outdoor-amphitheater">Outdoor Amphitheater</option>
                </select>
                <select id="reverb-mode" disabled>
                  <option value="depth" selected>üìè Depth</option>
                  <option value="uniform">üîÑ Uniform</option>
                </select>
              </div>
              <div class="reverb-wet-control">
                <label for="reverb-wet">üíß</label>
                <input type="range" id="reverb-wet" min="-24" max="6" value="0" step="0.5">
                <span id="reverb-wet-value">0.0 dB</span>
              </div>
            </div>

            <div class="ground-reflection-controls">
              <label for="ground-reflection-model">Ground reflections: <a href="https://github.com/antorsae/unmixed#physics-based-audio-simulation" target="_blank" rel="noopener" class="help-link" title="Learn about ground reflection">‚ìò</a></label>
              <select id="ground-reflection-model">
                <option value="none" selected>None</option>
                <option value="stage">Stage (wood)</option>
                <option value="hard">Hard (rigid)</option>
                <option value="soft">Soft (absorptive)</option>
              </select>
            </div>
          </div>

          <div class="hall-control-block hall-controls-bottom-left">
            <div class="mic-controls mic-controls-primary">
              <div class="mic-technique-control">
                <label for="mic-technique">Technique: <a id="mic-technique-wiki" href="https://en.wikipedia.org/wiki/Microphone_practice#A-B_stereo" target="_blank" rel="noopener" class="help-link" title="Learn about this technique">‚ìò</a></label>
                <select id="mic-technique">
                  <option value="spaced-pair" selected>Spaced Pair (AB)</option>
                  <option value="xy-coincident">XY Coincident</option>
                  <option value="ortf">ORTF</option>
                  <option value="blumlein">Blumlein</option>
                  <option value="decca-tree">Decca Tree</option>
                </select>
              </div>
              <div class="mic-pattern-control">
                <label for="mic-pattern">Pattern: <a href="https://github.com/antorsae/unmixed#polar-pattern-modeling" target="_blank" rel="noopener" class="help-link" title="Learn about polar patterns">‚ìò</a></label>
                <select id="mic-pattern">
                  <option value="omni" selected>Omni</option>
                  <option value="cardioid">Cardioid</option>
                  <option value="supercardioid">Supercardioid</option>
                  <option value="hypercardioid">Hypercardioid</option>
                  <option value="figure8">Figure-8</option>
                </select>
              </div>
            </div>
          </div>

          <div class="hall-control-block hall-controls-bottom-right">
            <div class="mic-controls mic-controls-secondary">
              <div class="mic-spacing-control">
                <label for="mic-spacing">‚Üî</label>
                <input type="range" id="mic-spacing" min="0.5" max="6" value="2" step="0.1">
                <span id="mic-spacing-value">2.00m</span>
              </div>
              <div class="mic-angle-control hidden">
                <label for="mic-angle">Angle:</label>
                <input type="range" id="mic-angle" min="60" max="135" value="90" step="5">
                <span id="mic-angle-value">90¬∞</span>
              </div>
              <div class="mic-center-controls hidden">
                <div class="mic-center-depth-control">
                  <label for="mic-center-depth">Center Depth:</label>
                  <input type="range" id="mic-center-depth" min="0.5" max="3" value="1.5" step="0.1">
                  <span id="mic-center-depth-value">1.5m</span>
                </div>
                <div class="mic-center-level-control">
                  <label for="mic-center-level">Center Level:</label>
                  <input type="range" id="mic-center-level" min="-12" max="6" value="0" step="0.5">
                  <span id="mic-center-level-value">0dB</span>
                </div>
              </div>
            </div>
          </div>

        </div>

        <canvas id="stage-canvas"></canvas>
        <div id="stage-labels">
          <span class="label-left">L</span>
          <span class="label-right">R</span>
          <span class="label-front">Front</span>
          <span class="label-back">Back</span>
        </div>
        </div>

        <div id="xtc-dock">
          <div class="xtc-panel">
            <div class="xtc-controls">
              <label class="checkbox-label">
                <input type="checkbox" id="xtc-enabled">
                Speaker XTC
                <span class="xtc-hint">post, speakers only</span>
              </label>
            </div>
            <div id="xtc-settings" class="xtc-settings hidden">
              <div class="xtc-row">
                <label for="xtc-strength">Strength</label>
                <input type="range" id="xtc-strength" min="0" max="100" value="60" step="1">
                <span id="xtc-strength-value">60%</span>
              </div>
              <div class="xtc-row">
                <label for="xtc-angle">Speaker Angle</label>
                <input type="range" id="xtc-angle" min="15" max="60" value="30" step="1">
                <span id="xtc-angle-value">30¬∞</span>
              </div>
              <div class="xtc-row">
                <label for="xtc-distance">Speaker Distance</label>
                <input type="range" id="xtc-distance" min="0.5" max="4" value="1.5" step="0.1">
                <span id="xtc-distance-value">1.50 m</span>
              </div>
              <div class="xtc-row">
                <label for="xtc-head-width">Head Width</label>
                <input type="range" id="xtc-head-width" min="12" max="24" value="18" step="0.5">
                <span id="xtc-head-width-value">18 cm</span>
              </div>
              <div class="xtc-row">
                <label for="xtc-hf">HF Rolloff</label>
                <input type="range" id="xtc-hf" min="800" max="8000" value="2200" step="50">
                <span id="xtc-hf-value">2200 Hz</span>
              </div>
              <div class="xtc-readout">
                <span>Delay: <span id="xtc-delay-value">0.00 ms</span></span>
                <span>Cross Gain: <span id="xtc-gain-value">-inf dB</span></span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Track list (collapsible) -->
    <section id="track-list-section" class="collapsed">
      <h2 id="track-list-header">
        <span class="collapse-icon">‚ñ∂</span>
        Tracks
        <span id="track-count"></span>
      </h2>
      <div class="track-list-actions">
        <div class="action-buttons">
          <button id="reset-positions-btn" class="btn secondary">Reset Positions</button>
          <button id="reset-all-btn" class="btn secondary">Reset All</button>
        </div>
        <div class="export-buttons">
          <button id="download-wav-btn" class="btn primary" disabled>üíæ WAV</button>
          <button id="download-mp3-btn" class="btn primary" disabled>üíæ MP3</button>
        </div>
      </div>
      <div id="track-list"></div>
    </section>

    <!-- Toast container -->
    <div id="toast-container"></div>

    <!-- Render progress modal -->
    <div id="render-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Rendering Mix</h3>
        <div class="progress-bar">
          <div class="progress-fill" id="render-progress-fill"></div>
        </div>
        <span id="render-progress-text">0%</span>
        <button id="cancel-render-btn" class="btn secondary">Cancel</button>
      </div>
    </div>

    <!-- Restore session modal -->
    <div id="restore-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Restore Previous Session?</h3>
        <p>A previous session was found. Would you like to restore it?</p>
        <div class="modal-buttons">
          <button id="restore-yes-btn" class="btn primary">Yes, Restore</button>
          <button id="restore-no-btn" class="btn secondary">No, Start Fresh</button>
        </div>
      </div>
    </div>

    <!-- Shared arrangement confirmation modal -->
    <div id="share-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Load Shared Arrangement?</h3>
        <div id="share-modal-details">
          <!-- Populated dynamically -->
        </div>
        <div class="modal-buttons">
          <button id="share-load-btn" class="btn primary">Load</button>
          <button id="share-cancel-btn" class="btn secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Mobile warning -->
    <div id="mobile-warning" class="hidden">
      <p>Desktop browser recommended for best experience.</p>
      <button id="dismiss-mobile-warning" class="btn secondary">Continue Anyway</button>
    </div>

    <!-- Footer -->
    <footer id="app-footer">
      <p>
        <a href="https://github.com/antorsae/unmixed" target="_blank" rel="noopener">GitHub</a>
        <span class="sep">|</span>
        Recordings: <a href="https://research.cs.aalto.fi/acoustics/virtual-acoustics/research/acoustic-measurement-and-analysis/85-anechoic-recordings.html" target="_blank" rel="noopener">Aalto University</a>
      </p>
    </footer>
  </div>

  <script type="module" src="js/app.js?v=27"></script>
</body>
</html>
